const bg=document.getElementById("bg"),ctx=bg.getContext("2d"),textEl=document.getElementById("text"),creditsEl=document.getElementById("credits"),startOverlay=document.getElementById("startOverlay"),musicEl=document.getElementById("music"),countdownEl=document.getElementById("countdown");let t=0,partyActive=!1,partyBlend=0,audioCtx=null,analyser=null,beat=0,beatEnv=0,showPhase=0,fireworksActive=!1,fireworksPhase=0,santaVisible=!1,santaReveal=0,santaDancing=!1,spotlightActive=!1,santaReady=!1,santaTargetX=0,santaTargetY=0,santaTargetRot=0,santaSmoothX=0,santaSmoothY=0,santaSmoothRot=0,santaAlpha=0,spotlightFade=1,hillPulse=0,hillColorShift=0,stars=[],hills=[],snow=[],snowAccum=[],fireworks=[],fireParticles=[],confetti=[],fireworkTimer,finaleStartTime,confettiActive=!1,confettiSpawnRate=1,particlesAllFaded=!1,fadeCheckInterval=null,replayButtonShown=!1,showComplete=!1,animationId=null,lastFinaleExplosion=0,santaEnergy=0;const santaImg=new Image;santaImg.src="assets/santa.png";const santa={x:0,y:0,drawX:0,drawY:0,rot:0};function drawSanta(){if(!santaReady)return;let e=santaImg.height*(180/santaImg.width);ctx.save(),ctx.globalAlpha=santaAlpha,ctx.translate(santa.drawX,santa.drawY),ctx.rotate(santa.rot),ctx.drawImage(santaImg,-90,-e-8,180,e),ctx.restore()}const wait=e=>new Promise(a=>setTimeout(a,e)),lerp=(e,a,o)=>e+(a-e)*o;function playCheeringSound(){console.log("\uD83C\uDF8A Playing cheering sound");let e=document.getElementById("cheering");cheeringActive=!0,cheeringStartTime=performance.now(),setTimeout(()=>{cheeringActive=!1,console.log("\uD83D\uDD07 Cheering visual effect ended")},5e3),e&&e.src?(e.currentTime=0,e.volume=.7,e.play().then(()=>{console.log("✅ Cheering audio playing")}).catch(e=>{console.warn("⚠️ Cheering audio blocked, continuing with visual only")})):console.log("ℹ️ No cheering audio found, using visual effect only")}function fadeOutCheeringSound(e,a=1e3){let o=e.volume,n=performance.now();function l(){let i=performance.now()-n,s=Math.min(i/a,1);e.volume=o*(1-Math.pow(s,2)),s<1?requestAnimationFrame(l):(e.pause(),e.currentTime=0,e.volume=.8,console.log("\uD83D\uDD07 Cheering sound faded out smoothly"))}requestAnimationFrame(l)}function playCheeringFallback(){console.log("\uD83C\uDF8A PLAYING CHEERING FALLBACK"),cheeringActive=!0,cheeringStartTime=performance.now(),console.log("✅ Visual cheering effect ACTIVATED");let e=(e,a=.25)=>{setTimeout(()=>{let o=document.getElementById("bassboom");o&&(console.log(`   Playing soft bassboom at ${e}ms (vol: ${a})`),o.volume=a,o.currentTime=0,o.play().catch(e=>{}))},e)};e(0,.3),e(350,.2),e(700,.15),setTimeout(()=>{cheeringActive=!1,console.log("\uD83D\uDD07 Cheering fallback finished")},5e3)}function showReplayButton(){if(console.log("=== SHOW REPLAY BUTTON ==="),console.log("replayButtonShown was:",replayButtonShown),replayButtonShown){console.log("Button al getoond, skipping");return}replayButtonShown=!0,showComplete=!0,setTimeout(()=>{let e=document.getElementById("replayButton");if(!e){console.error("❌ CRITICAL: Replay button niet gevonden in DOM!"),createReplayButtonFallback();return}console.log("✅ Replay button gevonden, toon hem"),console.log("Button voor show:",{display:window.getComputedStyle(e).display,opacity:window.getComputedStyle(e).opacity,visibility:window.getComputedStyle(e).visibility,zIndex:window.getComputedStyle(e).zIndex}),e.style.display="block",e.style.visibility="visible",e.style.opacity="0.01",e.offsetHeight,e.classList.add("show"),setTimeout(()=>{console.log("Button na show class:",{classList:e.className,computedOpacity:window.getComputedStyle(e).opacity,rect:e.getBoundingClientRect()})},50),e.style.animation="buttonPulse 2s infinite alternate",console.log("✅ Replay button zou nu zichtbaar moeten zijn")},2e3)}function createReplayButtonFallback(){console.log("\uD83D\uDEE0️ Maak replay button aan...");let e=document.createElement("div");e.id="replayButton",e.innerHTML='<button onclick="restartShow()">Opnieuw afspelen</button>',e.className="",document.body.appendChild(e),console.log("✅ Button aangemaakt, probeer opnieuw te tonen"),setTimeout(()=>{showReplayButton()},500)}const style=document.createElement("style");function restartShow(){console.log("=== RESTART SHOW ===");let e=document.getElementById("replayButton");function a(){console.log("Fase 2: Start eigenlijke restart"),animationId&&(cancelAnimationFrame(animationId),animationId=null),t=0,partyActive=!1,partyBlend=0,showPhase=0,fireworksActive=!1,fireworksPhase=0,santaVisible=!1,santaReveal=0,santaDancing=!1,spotlightActive=!1,replayButtonShown=!1,showComplete=!1,particlesAllFaded=!1,lastFinaleExplosion=0,confettiActive=!1,confettiSpawnRate=1,hillPulse=0,hillColorShift=0,santaEnergy=0,santaAlpha=0,cheeringStartTime=0,santaSmoothX=bg.width/2,santaSmoothY=0,santaSmoothRot=0,santaTargetX=bg.width/2,santaTargetY=0,santaTargetRot=0,stars=[],snow=[],snowAccum=Array(bg.width).fill(0),fireworks=[],fireParticles=[],confetti=[],fireworkTimer&&(clearInterval(fireworkTimer),fireworkTimer=null),fadeCheckInterval&&(clearInterval(fadeCheckInterval),fadeCheckInterval=null),musicEl&&(musicEl.pause(),musicEl.currentTime=0,musicEl.volume=1,console.log("Audio gereset")),textEl&&(textEl.innerHTML="",textEl.style.opacity="0",textEl.className="",textEl.style.transition=""),creditsEl&&(creditsEl.innerHTML="",creditsEl.className="",creditsEl.style.display="none");let e=document.getElementById("countdownInner");e&&(e.textContent="",e.style.opacity="0"),document.querySelectorAll("#bg, #fx").forEach(e=>{e.classList.remove("shake")}),startOverlay&&(startOverlay.style.display="none",startOverlay.classList.remove("active")),ctx.clearRect(0,0,bg.width,bg.height),ctx.fillStyle="#000",ctx.fillRect(0,0,bg.width,bg.height),initScene(),resize(),setTimeout(()=>{animationId||(console.log("Start nieuwe animation loop"),animationId=requestAnimationFrame(loop)),setTimeout(()=>{drawScene(),console.log("Eerste scene getekend na restart"),startOverlay&&(startOverlay.style.display="block",startOverlay.classList.add("active"),console.log("Overlay getoond - klaar voor klik")),console.log("Restart compleet. Variabelen:"),console.log("- showPhase:",showPhase),console.log("- santaVisible:",santaVisible),console.log("- replayButtonShown:",replayButtonShown),console.log("- animationId:",animationId?"running":"stopped")},50)},100)}e?(console.log("Fase 1: Reset replay button visueel"),e.classList.contains("show")?(console.log("Button is zichtbaar, start fade-out"),e.style.transition="opacity 0.3s ease-out, visibility 0.3s ease-out",e.style.opacity="0",e.style.visibility="hidden",setTimeout(()=>{e.classList.remove("show"),e.style.animation="",e.style.display="none",e.offsetHeight,a()},300)):(e.classList.remove("show"),e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.animation="",e.offsetHeight,a())):(console.log("Geen replay button gevonden, ga direct verder"),a())}async function startPartySequence(){await wait(15e3),await startCountdown(3),fireworksActive=!0,fireworksPhase=1;for(let e=0;e<4;e++)setTimeout(()=>{spawnFirework();let e=document.getElementById("boom");e&&(e.currentTime=0,e.play())},2500*e);await wait(10200),fireworksPhase=2,finaleStartTime=performance.now();let a=document.getElementById("finaleboom");a&&(a.currentTime=0,a.play(),a.onended=()=>{fireworksPhase=0,fireworksActive=!1,startParticleFadeOut()})}function resize(){let e=bg.width,a=snowAccum;if(bg.width=innerWidth,bg.height=innerHeight,a&&0!==e){snowAccum=Array(bg.width).fill(0);let o=Math.min(e,bg.width);for(let n=0;n<o;n++)snowAccum[n]=a[n]}else snowAccum=Array(bg.width).fill(0)}function initScene(){stars=Array.from({length:120},()=>({x:Math.random()*bg.width,y:Math.random()*bg.height*.6,r:.5+Math.random(),t:Math.random()*Math.PI*2})),snow=Array.from({length:240},()=>({x:Math.random()*bg.width,y:Math.random()*bg.height,vy:.6+.8*Math.random(),r:Math.random()*Math.PI*2,s:4+4*Math.random(),hue:360*Math.random()})),hills=[{y:.75,baseAmp:40,color:"#4b2b82"}]}function getHillY(e){if(!hills||!hills.length)return .75*bg.height;let a=hills[0],o=lerp(a.baseAmp,a.baseAmp+12*Math.sin(2*t)+22*beat,partyBlend);return bg.height*a.y+Math.sin(.01*e+t)*o}function fadeOutText(e=400){textEl.style.transition=`opacity ${e}ms ease-out`,textEl.style.opacity=0}function connectAudio(){if(audioCtx)return;analyser=(audioCtx=new(window.AudioContext||window.webkitAudioContext)).createAnalyser();let e=audioCtx.createMediaElementSource(musicEl);e.connect(analyser),analyser.connect(audioCtx.destination)}function playSound(e){console.log("\uD83D\uDD0A playSound called for:",e);let a=document.getElementById(e);if(a){console.log("  Audio element found:",a),console.log("  Source:",a.src),console.log("  Ready state:",a.readyState),a.currentTime=0;let o=a.play();if(void 0!==o)o.then(()=>{console.log("  ✅ Sound playing:",e)}).catch(o=>{console.warn("  ⚠️ Could not play",e,":",o.name),"bassboom"===e&&(console.log("  \uD83D\uDD04 Setting up bassboom fallback"),document.body.addEventListener("click",function e(){a.play().then(()=>{console.log("  ✅ Bassboom played after click"),document.body.removeEventListener("click",e)})},{once:!0}))});else try{a.play(),console.log("  ✅ Sound playing (old browser):",e)}catch(n){console.warn("  ⚠️ Old browser error:",n)}}else console.error("  ❌ Sound element not found:",e)}function detectBeat(){if(!analyser)return;let e=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(e);let a=0;for(let o=0;o<40;o++)a+=e[o];beatEnv=Math.max(.9*beatEnv,beat=Math.min(a/40/255*1.6,1))}function fadeOutAudio(e,a=2e3){let o=e.volume,n=performance.now();function l(i){let s=Math.min(1,(i-n)/a);e.volume=o*(1-s),s<1?requestAnimationFrame(l):e.pause()}requestAnimationFrame(l)}function spawnFirework(){let e=bg.width*(.2+.6*Math.random());fireworks.push({x:e,y:getHillY(e)-(snowAccum[Math.floor(e)]||0)+6,vx:(Math.random()-.5)*1.2,vy:-(8+3*Math.random()),exploded:!1}),playSound("boom")}function explodeFirework(e,a,o=!1){let n=o?10:6,l=o?18:14,i=o?1.2:1.1,s=o?.45:.4;for(let r=0;r<n;r++){let c=360*Math.random(),$=i+r*s;for(let d=0;d<l;d++){let g=d/l*Math.PI*2,h=$*(.85+.3*Math.random());fireParticles.push({x:e,y:a,vx:Math.cos(g)*h,vy:Math.sin(g)*h,life:o?120:90,max:o?120:90,hue:c,radius:0,ring:r})}}}function spawnConfetti(){let e=Math.floor(80*confettiSpawnRate);for(let a=0;a<e;a++)confetti.push({x:Math.random()*bg.width,y:-10-20*Math.random(),vy:.4+1*Math.random(),vx:(Math.random()-.5)*.8,rot:Math.random()*Math.PI,vr:(Math.random()-.5)*.04,hue:360*Math.random(),life:500,maxLife:500})}function startParticleFadeOut(){console.log("\uD83D\uDD25=== START PARTICLE FADE OUT ==="),console.log("FireParticles count:",fireParticles.length),fireParticles.forEach(e=>{e.fading=!0,e.fadeStartTime=performance.now(),e.fadeDuration=3e3,e.originalMax=e.max,e.originalLife=e.life}),particlesAllFaded=!1,fadeCheckInterval&&clearInterval(fadeCheckInterval),fadeCheckInterval=setInterval(()=>{console.log("Checking particles:",fireParticles.length,"remaining"),0===fireParticles.length&&(console.log("✅ All particles gone! Calling triggerBassBoomWithConfetti"),particlesAllFaded=!0,clearInterval(fadeCheckInterval),triggerBassBoomWithConfetti())},100)}function cleanupFadedParticles(){let e=fireParticles.length;0===(fireParticles=fireParticles.filter(e=>{if(e.fading){let a=performance.now()-e.fadeStartTime;if(a>=e.fadeDuration)return!1}return!0})).length&&e>0&&console.log("Alle particles zijn weg!")}function fadeOutSantaAndSpotlight(){console.log("Start smooth fade-out van Santa en spotlight");let e=0,a=performance.now();function o(){let n=performance.now()-a;e=Math.min(n/2e3,1),santaDancing&&(santaEnergy=Math.max(0,santaEnergy*(1-.1*e))),spotlightFade=1-e,e>.5&&santaDancing&&(santaDancing=!1,console.log("Santa stopped dancing at 50% fade")),e>=1?(spotlightActive=!1,console.log("Spotlight fully faded out")):requestAnimationFrame(o)}requestAnimationFrame(o)}function triggerBassBoomWithConfetti(){console.log("Alle particles weg, bassboom start!"),setTimeout(()=>{playSound("bassboom"),document.querySelectorAll("#bg, #fx").forEach(e=>e.classList.add("shake")),setTimeout(()=>{confettiActive=!0,confettiSpawnRate=.6,textEl.innerHTML="✨ Gelukkig nieuwjaar ✨",textEl.classList.add("glowText","newyear","breathe"),textEl.style.opacity=1,setTimeout(()=>{console.log("\uD83C\uDF8A Starting cheering sequence");let e=document.getElementById("cheering");if(e&&e.src){if(e.readyState>=2){console.log("✅ Cheering audio is loaded, attempting to play"),e.currentTime=0,e.volume=.7;let a=e.play();void 0!==a&&a.then(()=>{console.log("✅ Cheering sound started"),setTimeout(()=>{e.pause(),e.currentTime=0,console.log("\uD83D\uDD07 Cheering sound auto-stopped")},5e3)}).catch(e=>{console.log("ℹ️ Cheering autoplay blocked, user interaction required")})}else console.log("ℹ️ Cheering audio not ready, skipping")}else console.log("ℹ️ No cheering audio available")},300),setTimeout(()=>{confettiSpawnRate=.2},700),setTimeout(()=>{fadeOutAudio(musicEl,3e3)},2e3),setTimeout(()=>{showReplayButton()},6e3)},200)},500)}function drawScene(){let e=ctx.createLinearGradient(0,0,0,bg.height);if(e.addColorStop(0,partyBlend>0?`rgba(60,30,90,${.45*partyBlend})`:"rgb(12,12,30)"),e.addColorStop(1,"rgb(5,5,15)"),ctx.fillStyle=e,ctx.fillRect(0,0,bg.width,bg.height),stars.forEach(e=>{e.t+=.02,ctx.fillStyle=`rgba(255,200,255,${.35+.35*Math.sin(e.t)})`,ctx.beginPath(),ctx.arc(e.x,e.y,e.r,0,2*Math.PI),ctx.fill()}),hills.forEach(e=>{let a=bg.height*e.y-80,o=bg.height;void 0===hillPulse&&(hillPulse=0),void 0===hillColorShift&&(hillColorShift=0),partyActive?(hillPulse=.5*Math.sin(2*t)+.5,hillColorShift=(hillColorShift+.5)%360):hillPulse=0;let n,l;if(partyActive){let i=(240+hillColorShift)%360,s=70+30*(beatEnv||0),r=35+15*(beatEnv||0);n=`hsl(${i}, ${s}%, ${r}%)`,l=`hsl(${i-20}, ${s-20}%, ${r-20}%)`}else n="#5a3a9e",l="#2a163f";let c=ctx.createLinearGradient(0,a,0,o);partyActive?(c.addColorStop(0,n),c.addColorStop(.3,`hsl(${(hillColorShift+60)%360}, 70%, 40%)`),c.addColorStop(.7,`hsl(${(hillColorShift+120)%360}, 60%, 30%)`),c.addColorStop(1,l)):(c.addColorStop(0,n),c.addColorStop(1,l)),ctx.fillStyle=c,ctx.beginPath(),ctx.moveTo(0,bg.height);for(let $=0;$<=bg.width;$+=20){let d=getHillY($);partyActive&&(d+=15*Math.sin(.02*$+3*t)*(beatEnv||0)),ctx.lineTo($,d)}if(ctx.lineTo(bg.width,bg.height),ctx.closePath(),ctx.fill(),partyActive&&(beatEnv||0)>.2){ctx.save(),ctx.globalCompositeOperation="lighter",ctx.globalAlpha=.3*(beatEnv||0);let g=ctx.createLinearGradient(0,a,0,o);g.addColorStop(0,`rgba(255, 200, 255, ${.5*(beatEnv||0)})`),g.addColorStop(1,"transparent"),ctx.fillStyle=g,ctx.fill(),ctx.restore()}}),snow.forEach(e=>{partyActive&&(e.hue=(e.hue+2)%360),ctx.strokeStyle=partyActive?`hsla(${e.hue},100%,75%,0.6)`:"rgba(255,255,255,0.6)",ctx.beginPath();for(let a=0;a<6;a++){let o=a*Math.PI/3+e.r;ctx.moveTo(e.x,e.y),ctx.lineTo(e.x+Math.cos(o)*e.s,e.y+Math.sin(o)*e.s)}if(ctx.stroke(),e.y+=e.vy*(partyBlend>0?1.6:1),e.y>getHillY(e.x)-(snowAccum[Math.floor(e.x)]||0)){e.y=-10;let n=Math.floor(e.x);snowAccum[n]=Math.min((snowAccum[n]||0)+4,200),snowAccum[n-1]=Math.min((snowAccum[n-1]||0)+2.5,200),snowAccum[n+1]=Math.min((snowAccum[n+1]||0)+2.5,200)}}),partyActive&&(snowAccum=snowAccum.map(e=>Math.max(e-.02,0))),santaVisible){santaReveal<1&&(santaReveal+=.015);let a=bg.width/2,o=getHillY(a),n=o-(snowAccum[Math.floor(a)]||0),l=n-200;if(santaDancing){let i=.3*Math.pow(beatEnv,1.3),s=1.5*Math.sin(6*t);santaTargetX=a+5*Math.sin(1.2*t),santaTargetY=n-10*i-s,santaTargetRot=Math.sin(5*t)*(.06*i),santaSmoothX=lerp(santaSmoothX,santaTargetX,.1),santaSmoothY=lerp(santaSmoothY,santaTargetY,.15),santaSmoothRot=lerp(santaSmoothRot,santaTargetRot,.08)}else{let r=n,c=santaReveal<1?l+(r-l)*santaReveal:r;santaSmoothX=lerp(santaSmoothX,a,.05),santaSmoothY=lerp(santaSmoothY,c,.05),santaSmoothRot=lerp(santaSmoothRot,0,.05)}santa.drawX=santaSmoothX,santa.drawY=santaSmoothY,santa.rot=santaSmoothRot,santaAlpha=santaReveal,ctx.save(),ctx.globalAlpha=santaAlpha,ctx.translate(santa.drawX,santa.drawY),ctx.rotate(santa.rot);let $=santaImg.height*(180/santaImg.width);ctx.drawImage(santaImg,-90,-$-8,180,$),ctx.restore()}if(spotlightActive&&santaVisible){let d=santa.drawX,g=santa.drawY-80,h=120*beatEnv,u=220+h*partyBlend,y=ctx.createRadialGradient(d,g,0,d,g,u);partyActive?(y.addColorStop(0,`rgba(255, 255, 230, ${.35+.2*beatEnv})`),y.addColorStop(.6,`rgba(255, 200, 255, ${.2+.15*beatEnv})`),y.addColorStop(1,"rgba(0, 0, 0, 0)")):(y.addColorStop(0,"rgba(255, 255, 230, 0.35)"),y.addColorStop(1,"rgba(0, 0, 0, 0)")),ctx.save(),ctx.globalCompositeOperation="lighter",ctx.fillStyle=y,ctx.beginPath(),ctx.arc(d,g,u,0,2*Math.PI),ctx.fill(),ctx.restore()}fireParticles.forEach((e,a)=>{e.x+=e.vx,e.y+=e.vy,e.radius+=.8,e.life--;let o=e.life/e.max;if(e.fading){let n=Math.min(1,(performance.now()-e.fadeStartTime)/e.fadeDuration);o*=1-n,n>=1&&(e.life=-1)}let l=1-(e.ring??0)/12;ctx.strokeStyle=`hsla(${e.hue},100%,70%,${o*Math.max(.35,l)})`,ctx.lineWidth=1.2,ctx.beginPath(),ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),ctx.stroke()}),fireParticles.length>0&&0===fireworksPhase&&(ctx.save(),ctx.globalAlpha=.3,ctx.fillStyle="rgba(255, 255, 255, 0.1)",ctx.font="16px Arial",ctx.textAlign="center",ctx.fillText(`Fading ${fireParticles.length} particles...`,bg.width/2,bg.height-50),ctx.restore()),fireParticles=fireParticles.filter(e=>e.life>0),confetti.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.rot+=e.vr,e.life-=.5,(e.y>bg.height+50||e.life<=0)&&(e.life=-1);let a=Math.max(0,e.life/(e.maxLife||500));ctx.save(),ctx.translate(e.x,e.y),ctx.rotate(e.rot),ctx.fillStyle=`hsla(${e.hue}, 100%, 60%, ${a})`,ctx.fillRect(-4,-4,8,8),ctx.restore()}),confetti=confetti.filter(e=>e.life>0),confettiActive&&(spawnConfetti(),confettiSpawnRate*=.99)}function loop(){if(t%5<.016&&console.log("Show phase:",showPhase,"Santa visible:",santaVisible,"Santa reveal:",santaReveal),t+=.016,partyActive&&(hillPulse=.5*Math.sin(2*t)+.5,hillColorShift+=.5),detectBeat(),santaEnergy=Math.max(beatEnv,.88*santaEnergy),partyBlend=Math.max(0,Math.min(1,partyBlend+(partyActive?.01:-.01))),cleanupFadedParticles(),drawScene(),fireworksActive&&(fireworks.forEach((e,a)=>{e.x+=e.vx,e.y+=e.vy,e.vy+=.04,(e.vy>-3||e.y<.25*bg.height)&&(explodeFirework(e.x,e.y),fireworks.splice(a,1)),ctx.strokeStyle="white",ctx.beginPath(),ctx.moveTo(e.x,e.y),ctx.lineTo(e.x-3*e.vx,e.y-3*e.vy),ctx.stroke()}),2===fireworksPhase)){let e=performance.now();if(e-lastFinaleExplosion>700){lastFinaleExplosion=e;let a=bg.width*(.15+.7*Math.random()),o=bg.height*(.2+.4*Math.random());explodeFirework(a,o,!0)}}animationId=requestAnimationFrame(loop)}function onFinaleEnded(){santaDancing=!1}async function runShow(){console.log("=== RUN SHOW START ==="),santaVisible=!1,santaReveal=0,animationId||(console.log("Starting animation loop in runShow"),animationId=requestAnimationFrame(loop)),drawScene(),await wait(1500),santaVisible=!0,console.log("Santa visible gemaakt"),await showText("Beste familie"),await wait(3500),await showText("We wensen jullie een gelukkig en gezond 2026"),await wait(1800),await showCredits("mie en Ciske"),await hideText(),await hideCredits(),await showText("We gaan er een lap op geven zie !"),await wait(1800),await hideText(),await showText("Ben je er klaar voor ?..."),startOverlay&&(startOverlay.classList.add("active"),startOverlay.style.display="block"),console.log("=== RUN SHOW END ===")}async function showText(e){textEl.textContent=e,textEl.style.opacity=1}async function hideText(){textEl.style.opacity=0,await wait(1200)}async function showCredits(e){creditsEl.textContent=e,creditsEl.classList.remove("exit"),creditsEl.classList.add("enter"),creditsEl.style.display="block",await wait(3500)}async function hideCredits(){creditsEl.classList.remove("enter"),creditsEl.classList.add("exit"),await wait(1500),creditsEl.style.display="none"}async function startCountdown(e){let a=document.getElementById("countdownInner");if(a){a.style.opacity=1,a.style.transform="scale(1)",a.style.transition="none";for(let o=e;o>=0;o--){let n=0===o;a.textContent=n?"GO!":o,a.style.color=n?"#ff2a2a":`hsl(${40+40*o},100%,60%)`,a.style.transition="none",a.style.transform="scale(0.6)",a.style.opacity=0,a.offsetHeight,a.style.transition="transform 300ms ease-out, opacity 300ms ease-out",a.style.transform=n?"scale(2.4)":"scale(1.4)",a.style.opacity=1,await wait(n?500:800),n||(a.style.transition="opacity 200ms ease-in",a.style.opacity=0,await wait(200))}a.style.transition="opacity 400ms ease-out",a.style.opacity=0,await wait(400),a.textContent=""}}function startFinaleSequenceAfterFade(){console.log("Start finale sequence na fade"),fadeOutSantaAndSpotlight()}function handleStartOverlayClick(){if(0===showPhase)showPhase=1,startOverlay.style.display="none",connectAudio(),audioCtx&&audioCtx.resume(),santaVisible=!0,runShow();else if(1===showPhase){showPhase=2,fadeOutText(400),startOverlay.style.display="none";let e=document.getElementById("music");e&&e.play(),partyActive=!0,setTimeout(()=>spotlightActive=!0,4200),setTimeout(()=>santaDancing=!0,7200),startPartySequence()}}function testCheering(){console.log("=== \uD83E\uDDEA TEST CHEERING ==="),cheeringActive=!1,console.log("1. Testing visual effect..."),cheeringActive=!0,cheeringStartTime=performance.now(),setTimeout(()=>{cheeringActive=!1,console.log("✅ Visual effect test completed")},3e3),console.log("2. Testing audio element...");let e=document.getElementById("cheering");e?(console.log("✅ Audio element found"),console.log("   Source:",e.src),console.log("   Duration:",e.duration,"seconds"),console.log("   Ready state:",e.readyState),e.load(),e.onerror=function(){console.error("❌ Audio load error:",e.error)},e.onloadeddata=function(){console.log("✅ Audio loaded successfully")}):(console.error("❌ Audio element NOT FOUND"),console.log("\uD83D\uDCA1 Make sure this is in your HTML:"),console.log('<audio id="cheering" src="assets/cheering.mp3"></audio>')),console.log("3. Testing fallback in 4 seconds..."),setTimeout(()=>{console.log("Testing fallback sound..."),playCheeringFallback()},4e3),console.log("=== TEST RUNNING ==="),console.log("You should see a yellow glow for 3 seconds")}function testBassboom(){console.log("=== \uD83E\uDDEA TEST BASSSBOOM ===");let e=document.getElementById("bassboom");console.log("Bassboom element:",e),e?(console.log("Source:",e.src),console.log("Duration:",e.duration),console.log("Ready state:",e.readyState),e.currentTime=0,e.volume=.5,e.play().then(()=>{console.log("✅ Bassboom sound played successfully")}).catch(e=>{console.error("❌ Could not play bassboom:",e)})):(console.error("❌ Bassboom audio element not found!"),console.log("\uD83D\uDCA1 Check if this is in your HTML:"),console.log('<audio id="bassboom" src="assets/bassboom.mp3"></audio>'))}style.textContent=`
    @keyframes buttonPulse {
        0% { transform: translateX(-50%) scale(1); }
        100% { transform: translateX(-50%) scale(1.05); }
    }
`,document.head.appendChild(style),window.addEventListener("resize",resize),resize(),startOverlay.addEventListener("click",handleStartOverlayClick),window.addEventListener("load",function(){console.log("Window loaded, initializing..."),resize(),initScene(),animationId||(console.log("Starting animation loop from window load"),animationId=requestAnimationFrame(loop)),startOverlay&&(startOverlay.style.display="block",startOverlay.classList.add("active"))}),document.addEventListener("DOMContentLoaded",function(){console.log("\uD83D\uDD35 DOM geladen - start initialisatie"),resize(),initScene(),animationId||(console.log("\uD83D\uDD35 Start initi\xeble animation loop"),animationId=requestAnimationFrame(loop)),setTimeout(()=>{console.log("\uD83D\uDD35 Forceer eerste drawScene()"),drawScene()},100);let e=document.getElementById("startOverlay");e&&(e.style.display="block",e.classList.add("active"),console.log("\uD83D\uDD35 Overlay klaar voor klik")),e&&e.addEventListener("click",handleStartOverlayClick);let a=document.getElementById("replayButton");if(a){let o=a.querySelector("button");o&&(o.addEventListener("touchstart",function(){this.style.transform="scale(0.95)"}),o.addEventListener("touchend",function(){this.style.transform=""}))}santaImg.onload=function(){santaReady=!0,console.log("\uD83D\uDD35 Santa image geladen")},santaImg.src="assets/santa.png"}),console.log("\uD83C\uDFAE Debug functions available:"),console.log("  - testBassboom()     - Test bassboom sound"),console.log("  - testCheering()     - Test cheering effect");